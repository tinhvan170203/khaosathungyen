import{r as c,d as W,j as e,u as O,m as I,Q as M}from"./index-cb7c9cfe.js";import{d as Q}from"./GridView-9d203a73.js";import{c as U}from"./chidoanApi-f6d36d24.js";import"./index.esm-a80e06b2.js";import{u as X,C as G}from"./index.esm-15837c48.js";import{C as J,d as K}from"./FileDownload-8699f521.js";import{d as Z}from"./Add-a4ffd767.js";import{S as ee}from"./react-select.esm-582e497c.js";import{c as ae}from"./canboApi-0b5763d3.js";import{d as b}from"./dayjs.min-e2ae2d72.js";import{t as _}from"./thongkeApi-6d742d91.js";import"./TableChitietThiduathang-d8e58bf9.js";import"./TableBangthiduathang-424c57af.js";import{e as v,f as ne,P as te,h as se,i as oe,c as B,d,j as re,k as le,u as ie,a as de,I as C,l as D,m as $,n as R,o as z}from"./LastPage-dbb82f1e.js";import{B as N}from"./Button-6c93a4ab.js";import"./createSvgIcon-fd86aae4.js";import"./ButtonBase-378bd36d.js";import"./Link-7d4dbf72.js";import"./Flag-77eebb76.js";import"./Tooltip-b6739f89.js";function E(g){O();const u=ie(),{count:s,page:l,rowsPerPage:o,onPageChange:i}=g,p=t=>{i(t,0)},f=t=>{i(t,l-1)},x=t=>{i(t,l+1)},n=t=>{i(t,Math.max(0,Math.ceil(s/o)-1))};return e.jsxs(de,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(C,{onClick:p,disabled:l===0,"aria-label":"first page",children:u.direction==="rtl"?e.jsx(D,{}):e.jsx($,{})}),e.jsx(C,{onClick:f,disabled:l===0,"aria-label":"previous page",children:u.direction==="rtl"?e.jsx(R,{}):e.jsx(z,{})}),e.jsx(C,{onClick:x,disabled:l>=Math.ceil(s/o)-1,"aria-label":"next page",children:u.direction==="rtl"?e.jsx(z,{}):e.jsx(R,{})}),e.jsx(C,{onClick:n,disabled:l>=Math.ceil(s/o)-1,"aria-label":"last page",children:u.direction==="rtl"?e.jsx($,{}):e.jsx(D,{})})]})}E.propTypes={count:v.number.isRequired,onPageChange:v.func.isRequired,page:v.number.isRequired,rowsPerPage:v.number.isRequired};function ce({list:g,onChangeStatus:u}){const[s,l]=c.useState(0),[o,i]=c.useState(10);s>0&&Math.max(0,(1+s)*o-g.length);const p=(n,t)=>{l(t)},f=n=>{i(parseInt(n.target.value,10)),l(0)},x=W(n=>n.authReducer.roles_quanlydoanvien);return e.jsxs(e.Fragment,{children:[e.jsx(ne,{component:te,children:e.jsxs(se,{"aria-label":"custom pagination table",children:[e.jsx(oe,{children:e.jsxs(B,{children:[e.jsx(d,{align:"left",rowSpan:2,style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(d,{align:"left",rowSpan:2,style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Họ tên"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Ngày trưởng thành đoàn"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Đơn vị"}),e.jsx(d,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Chi tiết"})]})}),e.jsx(re,{children:(o>0?g.slice(s*o,s*o+o):g).map((n,t)=>e.jsxs(B,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:s*o+t+1}),e.jsx(d,{className:"border-r border-slate-300",align:"left",children:e.jsx("span",{className:"font-bold",children:n.hoten})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",children:b(n.ngaytruongthanhdoan).format("DD/MM/YYYY")}),e.jsx(d,{className:"border-r border-slate-300",align:"left",children:n.donvi.donvi.tendonvi}),e.jsxs(d,{className:"border-r border-slate-300",align:"right",children:[x.includes("thay-doi-truong-thanh-doan")&&e.jsx(N,{variant:"contained",color:"info",size:"small",onClick:()=>u(n._id),children:"Thay đổi trạng thái trưởng thành đoàn"}),e.jsx(N,{variant:"contained",color:"info",size:"small",style:{marginLeft:"12px"},onClick:()=>window.open(`/dashboard/thong-tin-doan-vien/${n._id}`,"_blank","noreferrer"),children:"Trang cá nhân"})]})]},n._id))})]})}),e.jsx("div",{children:e.jsx(le,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:g.length,rowsPerPage:o,page:s,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:p,onRowsPerPageChange:f,ActionsComponent:E,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:t,to:j,count:y}){return`hiển thị ${t} đến ${j} bản ghi trong tổng số ${y!==-1?y:`more than ${j}`} bản ghi`}})})]})}let he=[{label:"STT",key:"stt"},{label:"Họ tên",key:"hoten"},{label:"Ngày trưởng thành đoàn",key:"ngaytruongthanhdoan"},{label:"Đơn vị",key:"donvi"}];const $e=()=>{const[g,u]=c.useState(""),[s,l]=c.useState(""),[o,i]=I(),[p,f]=c.useState([]),[x,n]=c.useState({label:"",value:""}),[t,j]=c.useState(!1),[y,S]=c.useState([]),[k,T]=c.useState([]),F=O(),{register:P,handleSubmit:H,control:L,resetField:ge,setValue:Y,watch:w,formState:{errors:ue}}=X({defaultValues:{chidoans:{label:"Tất cả",value:""},tungay:"",denngay:"",hoten:""}});c.useEffect(()=>{(async()=>{try{let a=await ae.fetchYearMonth(),r=await U.getChidoanOfUser();f([{label:"Tất cả",value:""}].concat(r.data.map(m=>({value:m._id,label:m.tenchidoan})))),Y("tungay",a.data.year+"-01-01"),Y("denngay",a.data.year+"-"+a.data.month+"-15"),u(a.data.year+"-01-01"),l(a.data.year+"-"+a.data.month+"-15")}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(F("/login"),M.error(a.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(a.message)}})()},[]);const q=async h=>{let a={...h,chidoans:h.chidoans.value};try{i(!0);let r=await _.getTruongthanhdoans(a);T(r.data),n(h.chidoans),S(r.data.map((m,V)=>({stt:V+1,hoten:m.hoten,ngaytruongthanhdoan:b(m.ngaytruongthanhdoan).format("DD/MM/YYYY"),donvi:m.donvi.donvi.tendonvi}))),i(!1),j(!0)}catch(r){console.log(r.message)}},A=async h=>{i(!0);try{await _.changeStatusTruongthanhdoan(h);let a=[...k];a=a.filter(r=>r._id.toString()!==h),T(a),S(a.map((r,m)=>({stt:m+1,hoten:r.hoten,ngaytruongthanhdoan:b(r.ngaytruongthanhdoan).format("DD/MM/YYYY"),donvi:r.donvi.donvi.tendonvi}))),i(!1),M.success("Thay đổi trạng thái thành công",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(a){console.log(a.message)}};return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{color:"primary",fontSize:"large"}),e.jsxs("h4",{className:"font-bold text-gray-800 text-lg",children:["Theo dõi, thống kê đoàn viên trưởng thành đoàn từ ngày ",b(g).format("DD/MM/YYYY")," đến ngày ",b(s).format("DD/MM/YYYY")," - chi đoàn, liên chi đoàn: ",x==null?void 0:x.label]})]}),e.jsx("form",{onSubmit:H(q),children:e.jsxs("div",{className:"flex mt-4 px-4 space-x-2 md:flex-row justify-end items-start",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Họ tên: "}),e.jsx("input",{...P("hoten"),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                    focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Từ ngày: "}),e.jsx("input",{...P("tungay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Đến ngày: "}),e.jsx("input",{...P("denngay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Chi đoàn, liên chi đoàn: "}),e.jsx(G,{control:L,name:"chidoans",render:({field:h})=>e.jsx(ee,{options:p,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Tất cả",...h})})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6",children:e.jsxs(N,{size:"small",type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(Z,{})," Lấy dữ liệu"]})})]})}),t&&e.jsxs("div",{className:"px-4","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx(N,{color:"info",variant:"contained",size:"small",children:e.jsx(J,{data:y,headers:he,filename:`danhsachtruongthanhdoan_${w("tungay")}_${w("denngay")}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{}),e.jsx("span",{className:"text-sm",children:"Xuất file excel"})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(ce,{list:k,onChangeStatus:A})})]})]})};export{$e as default};
