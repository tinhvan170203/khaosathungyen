import{n as T,r as c,d as L,j as e,k as ie,m as de,u as ce,Q as j}from"./index-cb7c9cfe.js";import{d as ue}from"./GridView-9d203a73.js";import"./index.esm-a80e06b2.js";import{u as I,C as _}from"./index.esm-15837c48.js";import{d as Q}from"./Add-a4ffd767.js";import{d as he}from"./Close-44ff83f1.js";import{q as xe}from"./base-e8aaf39e.js";import{d as H}from"./Search-d4de9264.js";import{f as me,g as ge,S as pe,D as fe,a as be,h as je,d as ve,b as ye,c as Ce,e as Ne}from"./DialogDelete-8de6b3e8.js";import{d as ke}from"./donviApi-742a4ed2.js";import{S as $}from"./react-select.esm-582e497c.js";import{c as R,d as m,e as w,f as De,P as Se,h as Pe,i as Te,j as we,k as Oe,u as _e,a as K,I as k,l as M,m as F,n as A,o as W}from"./LastPage-dbb82f1e.js";import{B as v}from"./Button-6c93a4ab.js";import{S as G}from"./Switch-c4a576b8.js";import{s as Be}from"./ButtonBase-378bd36d.js";import"./createSvgIcon-fd86aae4.js";const O={getDois(a){const t="/doi/fetch";return T.get(t,{params:a})},addDoi(a){const t="/doi/add";return T.post(t,a)},editDoi(a){const t=`/doi/edit/${a.id_edit}`;return T.put(t,a)},deleteDoi(a,t){const o=`/doi/delete/${a}`;return T.delete(o,{params:t})}},$e=({row:a,page:t,rowsPerPage:o,index:l,onClickOpenDialogEdit:g,onClickOpenDialogDelete:r})=>{c.useState(null);const p=L(h=>h.authReducer.roles_quanlydoanvien);return e.jsxs(R,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(m,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t*o+l}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:a.tendoi}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:a.donvi.tendonvi}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:a.thutu}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:a.status===!0?e.jsx(v,{color:"success",children:"Active"}):e.jsx(v,{color:"warning",children:"NonActive"})}),e.jsxs(m,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[p&&p.includes("sửa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"info",size:"small",onClick:()=>g(a),children:e.jsx(me,{style:{fontSize:"20px"}})}),p&&p.includes("xóa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>r(a._id),children:e.jsx(ge,{style:{fontSize:"20px"}})})]})]},a._id)};function J(a){const t=_e(),{count:o,page:l,rowsPerPage:g,onPageChange:r}=a,p=i=>{r(i,0)},h=i=>{r(i,l-1)},D=i=>{r(i,l+1)},n=i=>{r(i,Math.max(0,Math.ceil(o/g)-1))};return e.jsxs(K,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(k,{onClick:p,disabled:l===0,"aria-label":"first page",children:t.direction==="rtl"?e.jsx(M,{}):e.jsx(F,{})}),e.jsx(k,{onClick:h,disabled:l===0,"aria-label":"previous page",children:t.direction==="rtl"?e.jsx(A,{}):e.jsx(W,{})}),e.jsx(k,{onClick:D,disabled:l>=Math.ceil(o/g)-1,"aria-label":"next page",children:t.direction==="rtl"?e.jsx(W,{}):e.jsx(A,{})}),e.jsx(k,{onClick:n,disabled:l>=Math.ceil(o/g)-1,"aria-label":"last page",children:t.direction==="rtl"?e.jsx(F,{}):e.jsx(M,{})})]})}J.propTypes={count:w.number.isRequired,onPageChange:w.func.isRequired,page:w.number.isRequired,rowsPerPage:w.number.isRequired};function Re({list:a,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o}){const[l,g]=c.useState(0),[r,p]=c.useState(10),h=l>0?Math.max(0,(1+l)*r-a.length):0,D=(i,f)=>{g(f)},n=i=>{p(parseInt(i.target.value,10)),g(0)};return e.jsxs(e.Fragment,{children:[e.jsx(De,{component:Se,children:e.jsxs(Pe,{"aria-label":"custom pagination table",children:[e.jsx(Te,{children:e.jsxs(R,{children:[e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên đội, công an cấp xã"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Đơn vị cấp trên"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Thứ tự"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(30, 41, 59 )"},children:"Trạng thái"}),e.jsx(m,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(we,{children:[(r>0?a.slice(l*r,l*r+r):a).map((i,f)=>e.jsx($e,{row:i,page:l,rowsPerPage:r,index:f+1,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o},i._id)),h>0&&e.jsx(R,{style:{height:53*h},children:e.jsx(m,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(Oe,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:a.length,rowsPerPage:r,page:l,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:D,onRowsPerPageChange:n,ActionsComponent:J,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:f,to:y,count:x}){return`hiển thị ${f} đến ${y} bản ghi trong tổng số ${x!==-1?x:`more than ${y}`} bản ghi`}})})]})}const qe=c.forwardRef(function(t,o){return e.jsx(pe,{direction:"up",ref:o,...t})}),ze=Be(k)({position:"absolute",right:"16px",top:"4px"});function Ee({open:a,item:t,onCloseDialogEdit:o,onSubmit:l,donvis:g}){const{register:r,handleSubmit:p,control:h,resetField:D,setValue:n,watch:i,formState:{errors:f}}=I({defaultValues:{tendoi:"",donvi:"",thutu:1,status:!0}});c.useEffect(()=>{t&&(n("tendoi",t.tendoi,{shouldValidate:!0}),n("thutu",t.thutu,{shouldValidate:!0}),n("status",t.status,{shouldValidate:!0}),n("donvi",{label:t.donvi.tendonvi,value:t.donvi._id},{shouldValidate:!0}))},[t]);const y=async x=>{if(l){const b={...x,id_edit:t._id};await l(b),o()}};return e.jsx(e.Fragment,{children:e.jsxs(fe,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(x,b)=>{b!=="backdropClick"&&o(x,b)},open:a,TransitionComponent:qe,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(be,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(je,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa đội nghiệp vụ, công an cấp xã"}),e.jsx(ze,{onClick:()=>o(),children:e.jsx(ve,{style:{color:"white"}})})]}),e.jsx(ye,{children:e.jsx(K,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:p(y),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đội nghiệp vụ, công an cấp xã: "]}),e.jsx("input",{...r("tendoi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...r("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(_,{name:"status",control:h,render:({field:{value:x,onChange:b}})=>e.jsx(G,{checked:x,onChange:b})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Đơn vị cấp trên: "]}),e.jsx(_,{control:h,name:"donvi",render:({field:x})=>e.jsx($,{required:!0,name:"donvi",options:g,className:"basic-multi-select my-4",classNamePrefix:"select",...x})})]}),e.jsx(Ce,{children:e.jsxs(v,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(Q,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const ts=()=>{let[a,t]=ie();const[o,l]=c.useState([]),[g,r]=c.useState(!1),[p,h]=c.useState([]),[D,n]=de(),i=ce(),[f,y]=c.useState([]),[x,b]=c.useState(""),[U,X]=c.useState(""),C=c.useMemo(()=>{const s=xe.parse(location.search);return{...s,tendoi:s.tendoi||"",donvi:s.donvi||""}},[location.search]),[B,q]=c.useState({status:!1,item:null}),Y=()=>{q({...B,status:!1})},Z=s=>{s.preventDefault(),t({...C,tendoi:x,donvi:U})},ee=s=>{q({item:s,status:!0})},[N,S]=c.useState({status:!1,id_Delete:null}),se=s=>{S({status:!0,id_Delete:s})},te=()=>{S({...N,status:!1})},ae=()=>{S({...N,status:!1})},{register:z,handleSubmit:ne,control:E,resetField:P,watch:Ve,formState:{errors:He}}=I({defaultValues:{tendoi:"",donvi:"",thutu:1,status:!0}});c.useEffect(()=>{(async()=>{try{let d=await ke.getDonvis();l(d.data.map(u=>({value:u._id,label:u.tendonvi}))),y([{label:"Tất cả",value:""}].concat(d.data.map(u=>({value:u._id,label:u.tendonvi}))))}catch(d){d.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),j.error(d.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(d.message)}})()},[]),c.useEffect(()=>{(async()=>{try{n(!0);let d=await O.getDois(C);h(d.data),setTimeout(()=>{n(!1)},400)}catch(d){d.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),n(!1),j.error(d.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}))}})()},[C]);const le=async s=>{let d={...s,queryParams:C};n(!0);try{let u=await O.addDoi(d);h(u.data.dois),setTimeout(()=>{n(!1)},400),P("tendoi"),P("thutu"),P("donvi"),P("status"),j.success(u.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(u){j.error(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),n(!1)}},re=async s=>{let d={...s,queryParams:C};n(!0);try{let u=await O.editDoi(d);h(u.data.dois),setTimeout(()=>{n(!1)},400),j.success(u.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(u){j.error(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),n(!1)}},oe=async()=>{n(!0);try{let s=await O.deleteDoi(N.id_Delete,{...C});h(s.data.dois),setTimeout(()=>{n(!1)},400),S({...N,status:!1}),j.success(s.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(s){S({...N,status:!1}),j.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),n(!1)}},V=L(s=>s.authReducer.roles_quanlydoanvien);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ue,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý đội nghiệp vụ, công an cấp xã"})]}),V&&V.includes("thêm mô hình tổ chức")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:ne(le),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đội nghiệp vụ, công an cấp xã: "]}),e.jsx("input",{...z("tendoi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...z("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(_,{name:"status",control:E,render:({field:{value:s,onChange:d}})=>e.jsx(G,{checked:s,onChange:d})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Đơn vị cấp trên: "]}),e.jsx(_,{control:E,name:"donvi",render:({field:s})=>e.jsx($,{required:!0,name:"donvi",options:o,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...s})})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(v,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(Q,{})," Thêm mới"]}),e.jsxs(v,{sx:{width:"220px",backgroundColor:"darkgray"},onClick:()=>r(!0),color:"info",variant:"contained",children:[e.jsx(H,{})," Chức năng tìm kiếm"]})]})]}),g&&e.jsxs("form",{onSubmit:s=>Z(s),className:"my-2 mt-4 mx-8 bg-slate-800 p-4 rounded-lg shadow-xl","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm đội công tác, công an cấp xã"}),e.jsx(k,{onClick:()=>r(!1),sx:{backgroundColor:"#ccc"},children:e.jsx(he,{sx:{color:"white"}})})]}),e.jsxs("div",{className:"flex space-x-4 mt-4",children:[e.jsx("div",{className:"flex-col flex basis-1/2",children:e.jsx("input",{type:"text",defaultValue:x,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:s=>b(s.target.value),placeholder:"Tên đội, công an cấp xã"})}),e.jsx("div",{className:"flex-col flex basis-1/2",children:e.jsx($,{name:"donvi",options:f,className:"basic-multi-select my-2",classNamePrefix:"select",placeholder:"Tất cả",onChange:s=>X(s.value)})})]}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(v,{sx:{width:"200px",backgroundColor:"slategray"},type:"submit",color:"info",variant:"contained",children:[e.jsx(H,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(Re,{list:p,onClickOpenDialogDelete:se,onClickOpenDialogEdit:ee})}),e.jsx(Ee,{open:B.status,item:B.item,onCloseDialogEdit:Y,onSubmit:re,donvis:o}),e.jsx(Ne,{open:N.status,onCloseDialogDelete:ae,onConfirmDelete:oe,onCancelDelete:te})]})};export{ts as default};
