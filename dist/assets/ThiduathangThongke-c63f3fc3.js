import{r as t,m as G,u as I,j as e,Q as J}from"./index-af889cc1.js";import{d as K}from"./GridView-81a883b8.js";import{c as W}from"./chidoanApi-f62ed492.js";import"./index.esm-a80e06b2.js";import{u as Z,C as ee}from"./index.esm-c3d487d5.js";import{C as ae,d as te}from"./FileDownload-0dedbaf1.js";import{d as se}from"./Add-2c2882de.js";import{S as y}from"./react-select.esm-34b6099d.js";import{c as le}from"./canboApi-f8430c3d.js";import{d as j}from"./dayjs.min-f7728a8e.js";import{t as v}from"./thongkeApi-56a36351.js";import{T as ne}from"./TableChitietThiduathang-7631720b.js";import{T as oe}from"./TableBangthiduathang-76b8e40e.js";import{B as N}from"./Button-37b8afe6.js";import"./createSvgIcon-c7fd463f.js";import"./ButtonBase-df984b9e.js";import"./Link-f05ffa2b.js";import"./LastPage-dd44c61f.js";import"./Flag-dbb098c8.js";import"./Tooltip-0cb4e158.js";let re=[{label:"STT",key:"stt"},{label:"Họ tên",key:"hoten"},{label:"Số lượt cờ xanh",key:"blue"},{label:"Số lượt cờ vàng",key:"yellow"}];const Ee=()=>{const[S,h]=t.useState(""),[T,x]=t.useState(""),[ie,m]=G(),[C,w]=t.useState([]),[r,Y]=t.useState({label:"",value:""}),[de,B]=t.useState(null),[_,k]=t.useState(null),[D,E]=t.useState(null),[f,L]=t.useState([]),[$,M]=t.useState(!1),[O,F]=t.useState([]),[i,g]=t.useState(0),[H,P]=t.useState([]),[V,z]=t.useState([]),[d,A]=t.useState(""),[R,p]=t.useState([]),q=I(),{register:u,handleSubmit:Q,control:U,resetField:ce,setValue:b,watch:c,formState:{errors:me}}=Z({defaultValues:{chidoans:{label:"Tất cả",value:""},tungay:"",denngay:"",hoten:""}});t.useEffect(()=>{(async()=>{try{let a=await le.fetchYearMonth(),l=await W.getChidoanOfUser();w([{label:"Tất cả",value:""}].concat(l.data.map(o=>({value:o._id,label:o.tenchidoan})))),b("tungay",a.data.year+"-01-01"),b("denngay",a.data.year+`-${("0"+a.data.month).slice(-2)}-15`),g(a.data.year);let n=[];for(let o=a.data.year;o>=2020;o--)n.push({label:o,value:o});P(n),h(a.data.year+"-01-01"),x(a.data.year+`-${("0"+a.data.month).slice(-2)}-15`)}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(q("/login"),J.error(a.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(a.message)}})()},[]);const X=async s=>{let a={...s,chidoans:s.chidoans.value};try{m(!0),h(c("tungay")),x(c("denngay"));let l=await v.getThiduathangs(a);B(l.data.tongsocanbo),L(l.data.data_not_red),k(l.data.total_blue),E(l.data.total_yellow),Y(s.chidoans),F(l.data.data_not_red.map((n,o)=>({stt:o+1,hoten:n.hoten,blue:n.blue,yellow:n.yellow}))),M(!0)}catch(l){console.log(l.message)}};return t.useEffect(()=>{i!==0&&(async()=>{m(!0);try{let a=await v.getBangThiduathangs({year:i,chidoans:r.value}),l=a.data.filter(n=>n.hoten.toLowerCase().includes(d.toLowerCase()));z(a.data),p(l),m(!1)}catch(a){console.log(a.message)}})()},[i,r]),t.useEffect(()=>{let s=[...V];if(s.length>0){const a=setTimeout(()=>{let l=s.filter(n=>n.hoten.toLowerCase().includes(d.toLowerCase()));p(l)},500);return()=>clearTimeout(a)}},[d]),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(K,{color:"primary",fontSize:"large"}),e.jsxs("h4",{className:"font-bold text-gray-800 text-lg",children:["Theo dõi, thống kê thi đua tháng từ ngày ",j(S).format("DD/MM/YYYY")," đến ngày ",j(T).format("DD/MM/YYYY")," - chi đoàn, liên chi đoàn: ",r==null?void 0:r.label]})]}),e.jsx("form",{onSubmit:Q(X),children:e.jsxs("div",{className:"flex flex-col mt-4 px-4 md:flex-row md:flex-wrap justify-end items-start",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Họ tên: "}),e.jsx("input",{...u("hoten"),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                    focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Từ ngày: "}),e.jsx("input",{...u("tungay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Đến ngày: "}),e.jsx("input",{...u("denngay"),type:"date",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col md:basis-1/6 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Chi đoàn, liên chi đoàn: "}),e.jsx(ee,{control:U,name:"chidoans",render:({field:s})=>e.jsx(y,{options:C,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Tất cả",...s})})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6 px-1",children:e.jsxs(N,{size:"small",type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(se,{})," Lấy dữ liệu"]})})]})}),$&&e.jsxs("div",{className:"px-4","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("h3",{className:"font-bold",children:["Phần mềm phát hiện ",f.length," đoàn viên xếp loại thi đua tháng cờ xanh hoặc vàng với tổng số lượt: "]}),e.jsxs("div",{className:"pl-8 mb-8",children:[e.jsxs("div",{className:"font-arial",children:[" - Cờ xanh: ",_," lượt"]}),e.jsxs("div",{className:"font-arial",children:[" - Cờ vàng: ",D," lượt"]})]}),e.jsx(N,{color:"info",variant:"contained",size:"small",children:e.jsx(ae,{data:O,headers:re,filename:`canhancoxanh_vang_${c("tungay")}_${c("denngay")}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{}),e.jsx("span",{className:"text-sm",children:"Xuất file excel"})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(ne,{list:f})})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("h3",{className:"text-center mt-4 font-mono text-xl font-bold",children:["Bảng theo dõi thi đua năm ",i," - ",r==null?void 0:r.label]}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex  px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Họ tên: "}),e.jsx("input",{value:d,name:"search",onChange:s=>A(s.target.value),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                    focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsx("label",{className:"underline font-semibold",children:"Tùy chỉnh năm để lấy dữ liệu:"}),e.jsx(y,{value:{label:i,value:i},required:!0,name:"nam",options:H,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:s=>g(s.value)})]})]}),e.jsx("div",{children:e.jsx(oe,{list:R})})]})]})};export{Ee as default};
