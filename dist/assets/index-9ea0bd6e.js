import{r as p,d as E,j as e,u as Z,m as ee,Q as v,f as q}from"./index-af889cc1.js";import{d as se}from"./GridView-81a883b8.js";import"./index.esm-a80e06b2.js";import{u as H,C}from"./index.esm-c3d487d5.js";import{d as F}from"./Add-2c2882de.js";import{S as P}from"./react-select.esm-34b6099d.js";import{r as ae}from"./roleApi-32545ef7.js";import{c as R,d as u,e as T,f as te,P as le,h as ne,i as re,j as oe,k as ie,u as de,a as W,I as S,l as V,m as $,n as z,o as A}from"./LastPage-dd44c61f.js";import{f as ce,g as ue,S as he,D as me,a as xe,h as pe,d as ge,b as fe,c as be,e as je}from"./DialogDelete-4539fb54.js";import{B as _}from"./Button-37b8afe6.js";import{s as ye}from"./ButtonBase-df984b9e.js";import{d as ve}from"./donviApi-6df4dd62.js";import{c as ke}from"./chidoanApi-f62ed492.js";import"./createSvgIcon-c7fd463f.js";const Ne=({row:l,page:a,rowsPerPage:d,index:n,onClickOpenDialogEdit:m,onClickOpenDialogDelete:i})=>{p.useState(null);const x=E(r=>r.authReducer.roles_quanlydoanvien);return e.jsxs(R,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(u,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:a*d+n}),e.jsx(u,{className:"border-r border-slate-300",align:"left",children:l.tentaikhoan}),e.jsx(u,{className:"border-r border-slate-300",align:"left",children:l.matkhau}),e.jsx(u,{className:"border-r border-slate-300",align:"left",children:l.roles.map(r=>e.jsxs("span",{children:[r.tennhom,", "]},r._id))}),e.jsx(u,{className:"border-r border-slate-300",align:"left",children:l.quantrinhomdonvi.map(r=>e.jsxs("span",{children:[r.tendonvi,", "]},r._id))}),e.jsx(u,{className:"border-r border-slate-300",align:"left",children:l.quantrinhomchidoan.map(r=>e.jsxs("span",{children:[r.tenchidoan,", "]},r._id))}),e.jsxs(u,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[x&&x.includes("sửa tài khoản")&&e.jsx(_,{variant:"contained",color:"info",size:"small",onClick:()=>m(l),children:e.jsx(ce,{style:{fontSize:"20px"}})}),x&&x.includes("xóa tài khoản")&&e.jsx(_,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>i(l._id),children:e.jsx(ue,{style:{fontSize:"20px"}})})]})]},l._id)};function Q(l){const a=de(),{count:d,page:n,rowsPerPage:m,onPageChange:i}=l,x=s=>{i(s,0)},r=s=>{i(s,n-1)},b=s=>{i(s,n+1)},j=s=>{i(s,Math.max(0,Math.ceil(d/m)-1))};return e.jsxs(W,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(S,{onClick:x,disabled:n===0,"aria-label":"first page",children:a.direction==="rtl"?e.jsx(V,{}):e.jsx($,{})}),e.jsx(S,{onClick:r,disabled:n===0,"aria-label":"previous page",children:a.direction==="rtl"?e.jsx(z,{}):e.jsx(A,{})}),e.jsx(S,{onClick:b,disabled:n>=Math.ceil(d/m)-1,"aria-label":"next page",children:a.direction==="rtl"?e.jsx(A,{}):e.jsx(z,{})}),e.jsx(S,{onClick:j,disabled:n>=Math.ceil(d/m)-1,"aria-label":"last page",children:a.direction==="rtl"?e.jsx($,{}):e.jsx(V,{})})]})}Q.propTypes={count:T.number.isRequired,onPageChange:T.func.isRequired,page:T.number.isRequired,rowsPerPage:T.number.isRequired};function Ce({list:l,onClickOpenDialogEdit:a,onClickOpenDialogDelete:d}){const[n,m]=p.useState(0),[i,x]=p.useState(10),r=n>0?Math.max(0,(1+n)*i-l.length):0,b=(s,h)=>{m(h)},j=s=>{x(parseInt(s.target.value,10)),m(0)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{component:le,children:e.jsxs(ne,{"aria-label":"custom pagination table",children:[e.jsx(re,{children:e.jsxs(R,{children:[e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên tài khoản"}),e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"mật khẩu"}),e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Nhóm quyền hệ thống"}),e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm đơn vị"}),e.jsx(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm chi đoàn"}),e.jsx(u,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(oe,{children:[(i>0?l.slice(n*i,n*i+i):l).map((s,h)=>e.jsx(Ne,{row:s,page:n,rowsPerPage:i,index:h+1,onClickOpenDialogEdit:a,onClickOpenDialogDelete:d},s._id)),r>0&&e.jsx(R,{style:{height:53*r},children:e.jsx(u,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(ie,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:l.length,rowsPerPage:i,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:b,onRowsPerPageChange:j,ActionsComponent:Q,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:h,to:k,count:N}){return`hiển thị ${h} đến ${k} bản ghi trong tổng số ${N!==-1?N:`more than ${k}`} bản ghi`}})})]})}const Pe=p.forwardRef(function(a,d){return e.jsx(he,{direction:"up",ref:d,...a})}),De=ye(S)({position:"absolute",right:"16px",top:"4px"});function Se({open:l,item:a,onCloseDialogEdit:d,onSubmit:n,roles:m,donvis:i,chidoans:x}){const{register:r,handleSubmit:b,control:j,resetField:s,setValue:h,watch:k,formState:{errors:N}}=H({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomchidoan:"",quantrinhomdonvi:""}});p.useEffect(()=>{a&&(h("tentaikhoan",a.tentaikhoan,{shouldValidate:!0}),h("matkhau",a.matkhau,{shouldValidate:!0}),h("roles",a.roles.map(o=>({value:o._id,label:o.tennhom})),{shouldValidate:!0}),h("quantrinhomdonvi",a.quantrinhomdonvi.map(o=>({value:o._id,label:o.tendonvi})),{shouldValidate:!0}),h("quantrinhomchidoan",a.quantrinhomchidoan.map(o=>({value:o._id,label:o.tenchidoan})),{shouldValidate:!0}))},[a]);const O=async o=>{if(n){const g={...o,id_edit:a._id};await n(g),d()}};return e.jsx(e.Fragment,{children:e.jsxs(me,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(o,g)=>{g!=="backdropClick"&&d(o,g)},open:l,TransitionComponent:Pe,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(xe,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(pe,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa tài khoản người dùng"}),e.jsx(De,{onClick:()=>d(),children:e.jsx(ge,{style:{color:"white"}})})]}),e.jsx(fe,{children:e.jsx(W,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:b(O),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...r("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...r("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(C,{control:j,name:"roles",render:({field:o})=>e.jsx(P,{isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...o,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm đơn vị: "]}),e.jsx(C,{control:j,name:"quantrinhomdonvi",render:({field:o})=>e.jsx(P,{isMulti:!0,options:i,className:"basic-multi-select my-4",classNamePrefix:"select",...o,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm chi đoàn: "]}),e.jsx(C,{control:j,name:"quantrinhomchidoan",render:({field:o})=>e.jsx(P,{required:!0,isMulti:!0,options:x,className:"basic-multi-select my-4",classNamePrefix:"select",...o})})]}),e.jsx(be,{children:e.jsxs(_,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(F,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const Qe=()=>{const[l,a]=p.useState([]),[d,n]=p.useState([]),[m,i]=p.useState([]),[x,r]=p.useState([]),b=Z(),[j,s]=ee(),h=E(t=>t.authReducer.roles_quanlydoanvien),[k,N]=p.useState({status:!1,item:null}),O=()=>{N({...k,status:!1})},o=t=>{N({item:t,status:!0})},[g,D]=p.useState({status:!1,id_Delete:null}),L=t=>{D({status:!0,id_Delete:t})},U=()=>{D({...g,status:!1})},I=()=>{D({...g,status:!1})},{register:M,handleSubmit:K,control:w,resetField:B,watch:qe,formState:{errors:Te}}=H({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomdonvi:"",quantrinhomchidoan:""}});p.useEffect(()=>{(async()=>{try{let c=await ae.getRoles(),f=await ve.getDonvis(),Y=await ke.getChidoans({tenchidoan:""});n(c.data.map(y=>({value:y._id,label:y.tennhom}))),i(f.data.map(y=>({label:y.tendonvi,value:y._id}))),r(Y.data.map(y=>({label:y.tenchidoan,value:y._id})))}catch(c){c.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(b("/login"),v.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(c.message)}})()},[]),p.useEffect(()=>{(async()=>{s(!0);try{let c=await q.getUsers();a(c.data),setTimeout(()=>{s(!1)},400)}catch(c){c.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(b("/login"),v.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(c.message)}})()},[]);const G=async t=>{let c={...t};s(!0);try{let f=await q.addUser(c);a(f.data.users),setTimeout(()=>{s(!1)},400),B("tentaikhoan"),B("matkhau"),B("roles"),v.success(f.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(f){v.error(f.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},J=async t=>{let c={...t};s(!0);try{let f=await q.editUser(c);a(f.data.users),setTimeout(()=>{s(!1)},400),v.success(f.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(f){v.error(f.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},X=async()=>{s(!0);try{let t=await q.deleteUser(g.id_Delete);a(t.data.users),setTimeout(()=>{s(!1)},400),D({...g,status:!1}),v.success(t.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(t){D({...g,status:!1}),v.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}};return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(se,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý tài khoản hệ thống"})]}),h&&h.includes("thêm tài khoản")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:K(G),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...M("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`,placeholder:"Vui lòng nhập tên tài khoản"})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...M("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`,placeholder:"Vui lòng nhập mật khẩu"})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(C,{control:w,name:"roles",render:({field:t})=>e.jsx(P,{required:!0,isMulti:!0,options:d,className:"basic-multi-select my-4",classNamePrefix:"select",...t,placeholder:"Vui lòng chọn nhóm quyền hệ thống"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các đơn vị: "]}),e.jsx(C,{control:w,name:"quantrinhomdonvi",render:({field:t})=>e.jsx(P,{required:!0,isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...t,placeholder:"Vui lòng chọn đơn vị"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các chi đoàn: "]}),e.jsx(C,{control:w,name:"quantrinhomchidoan",render:({field:t})=>e.jsx(P,{required:!0,placeholder:"Vui lòng chọn chi đoàn",isMulti:!0,options:x,className:"basic-multi-select my-4",classNamePrefix:"select",...t})})]}),e.jsx("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:e.jsxs(_,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(F,{})," Thêm mới"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(Ce,{list:l,onClickOpenDialogDelete:L,onClickOpenDialogEdit:o})}),e.jsx(Se,{open:k.status,item:k.item,onCloseDialogEdit:O,onSubmit:J,roles:d,donvis:m,chidoans:x}),e.jsx(je,{open:g.status,onCloseDialogDelete:I,onConfirmDelete:X,onCancelDelete:U})]})};export{Qe as default};
