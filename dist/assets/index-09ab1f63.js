import{r,k as $,m as z,u as I,d as M,j as e,Q as i}from"./index-cb7c9cfe.js";import{d as Q}from"./GridView-9d203a73.js";import"./index.esm-a80e06b2.js";import{u as R,C as A}from"./index.esm-15837c48.js";import{d as L}from"./Close-44ff83f1.js";import{d as N}from"./Search-d4de9264.js";import{d as G}from"./Add-a4ffd767.js";import{q as J}from"./base-e8aaf39e.js";import{T as K,E as U,n as m}from"./EditModal-48de0df9.js";import{e as W}from"./DialogDelete-8de6b3e8.js";import{S as X}from"./Switch-c4a576b8.js";import{B as f}from"./Button-6c93a4ab.js";import{I as Y}from"./LastPage-dbb82f1e.js";import"./createSvgIcon-fd86aae4.js";import"./ButtonBase-378bd36d.js";const xe=()=>{const[v,p]=r.useState(!1),[x,y]=r.useState(""),[D,d]=r.useState([]);let[Z,k]=$();const[u,s]=z(),O=I(),l=r.useMemo(()=>{const t=J.parse(location.search);return{...t,thongbao:t.thongbao||""}},[location.search]),[h,b]=r.useState({status:!1,item:null}),S=()=>{b({...h,status:!1})},w=t=>{b({item:t,status:!0})},[n,c]=r.useState({status:!1,id_Delete:null}),T=t=>{c({status:!0,id_Delete:t})},E=()=>{c({...n,status:!1})},P=()=>{c({...n,status:!1})},{register:j,handleSubmit:B,control:_,resetField:g,watch:ee,formState:{errors:te}}=R({defaultValues:{thongbao:"",thutu:1,status:!0}}),H=t=>{t.preventDefault(),k({...l,thongbao:x})};r.useEffect(()=>{(async()=>{try{s(!0);let a=await m.getNotifications(l);d(a.data),u(a.data),setTimeout(()=>{s(!1)},400)}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(O("/login"),s(!1),i.error(a.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}))}})()},[l]);const q=async t=>{let a={...t,queryParams:l};s(!0);try{let o=await m.addNotification(a);d(o.data.notifications),u(o.data.notifications),setTimeout(()=>{s(!1)},400),g("thongbao"),g("thutu"),g("status"),i.success(o.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(o){i.error(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},F=async t=>{let a={...t,queryParams:l};s(!0);try{let o=await m.editNotification(a);d(o.data.notifications),u(o.data.notifications),setTimeout(()=>{s(!1)},400),i.success(o.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(o){i.error(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},V=async()=>{s(!0);try{let t=await m.deleteNotification(n.id_Delete,{...l});d(t.data.notifications),u(t.data.notifications),setTimeout(()=>{s(!1)},400),c({...n,status:!1}),i.success(t.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(t){c({...n,status:!1}),i.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},C=M(t=>t.authReducer.roles_quanlydoanvien);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý thanh thông báo"})]}),C&&C.includes("thêm thông báo")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:B(q),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nội dung thông báo mới: "]}),e.jsx("input",{...j("thongbao",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự xuất hiện: "]}),e.jsx("input",{...j("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái hiển thị:"}),e.jsx(A,{name:"status",control:_,render:({field:{value:t,onChange:a}})=>e.jsx(X,{checked:t,onChange:a})})]})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(f,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(G,{})," Thêm mới"]}),e.jsxs(f,{sx:{width:"220px",backgroundColor:"darkgray"},onClick:()=>p(!0),color:"info",variant:"contained",children:[e.jsx(N,{})," Chức năng tìm kiếm"]})]})]}),v&&e.jsxs("form",{onSubmit:t=>H(t),className:"my-2 mt-4 mx-8 bg-slate-800 p-4 rounded-lg shadow-xl","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm thông báo"}),e.jsx(Y,{onClick:()=>p(!1),sx:{backgroundColor:"#ccc"},children:e.jsx(L,{sx:{color:"white"}})})]}),e.jsx("div",{className:"flex space-x-4 mt-2",children:e.jsx("div",{className:"flex-col flex flex-1",children:e.jsx("input",{type:"text",defaultValue:x,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:t=>y(t.target.value),placeholder:"Nội dung thông báo"})})}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(f,{sx:{width:"200px",backgroundColor:"slategray"},type:"submit",color:"info",variant:"contained",children:[e.jsx(N,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(K,{list:D,onClickOpenDialogDelete:T,onClickOpenDialogEdit:w})}),e.jsx(U,{open:h.status,item:h.item,onCloseDialogEdit:S,onSubmit:F}),e.jsx(W,{open:n.status,onCloseDialogDelete:P,onConfirmDelete:V,onCancelDelete:E})]})};export{xe as default};
